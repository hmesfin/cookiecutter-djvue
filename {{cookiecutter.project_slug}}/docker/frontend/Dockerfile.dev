{% if cookiecutter.use_docker == 'y' -%}
# Development Dockerfile for frontend
FROM node:{{ cookiecutter.node_version }}-alpine

WORKDIR /app

# Install system dependencies
RUN apk add --no-cache git

# Create entrypoint script that handles initial setup
RUN cat > /docker-entrypoint.sh << 'EOF'
#!/bin/sh
set -e

# Check if package.json exists (will be mounted via volume)
if [ -f "package.json" ]; then
    # Install dependencies if node_modules doesn't exist
    if [ ! -d "node_modules" ]; then
        echo "Installing Node.js dependencies..."
        npm install
    fi
else
    echo "Waiting for package.json to be mounted..."
    sleep 2
fi

# Execute the main command
exec "$@"
EOF

RUN chmod +x /docker-entrypoint.sh

# Expose Vite dev server port
EXPOSE 5173

# Use entrypoint to handle setup
ENTRYPOINT ["/docker-entrypoint.sh"]

# Start Vite dev server
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
{%- endif %}